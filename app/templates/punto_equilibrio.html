{% extends "base.html" %}

{% block title %}Calculadora Punto de Equilibrio{% endblock %}

{% block content %}
<a href="/" class="btn back-btn">
    <i style="margin-right: 8px;">‚Üê</i> Volver al men√∫
</a>

<h1>‚öñÔ∏è Calculadora de Punto de Equilibrio</h1>
<p class="subtitle">
    Determine cu√°ntas unidades necesita fabricar para cubrir todos los gastos
</p>

<div style="max-width: 600px; margin: 0 auto;">
    <div id="cargando" style="text-align: center; color: #7f8c8d; font-size: 16px;">
        <i style="margin-right: 8px;">‚è≥</i> Cargando trabajadores...
    </div>

    <form id="formulario_equilibrio" action="/calcular-equilibrio" method="post" style="display: none;">
    
        <div class="form-group">
            <label for="precio_unidad">
                <i style="color: #667eea; margin-right: 8px;">üíµ</i> Precio por Unidad:
            </label>
            <input 
                type="number" 
                id="precio_unidad" 
                name="precio_unidad" 
                min="0" 
                step="0.01"
                placeholder="0.00" 
                required
            >
            <small>Precio al que pagaran cada unidad (COP)</small>
        </div>

        <div class="form-group">
            <label for="unidades_fabricadas">
                <i style="color: #667eea; margin-right: 8px;">üì¶</i> Unidades Fabricadas Hoy (Opcional):
            </label>
            <input 
                type="number" 
                id="unidades_fabricadas" 
                name="unidades_fabricadas" 
                min="0" 
                step="1"
                placeholder="0" 
            >
            <small>Ingrese para calcular la ganancia real del d√≠a</small>
        </div>

        <button type="submit" class="btn">
            <i style="margin-right: 8px;">üßÆ</i> Calcular Punto de Equilibrio
        </button>
    </form>

    <div style="margin-top: 40px; padding: 25px; background: linear-gradient(135deg, #fff3cd 0%, #ffe0a1 100%); border-radius: 12px; border-left: 5px solid #ffc107; display: none;" id="info_trabajadores">
        <h3 style="margin-top: 0; color: #856404;">
            <i style="margin-right: 8px;">üí°</i> ¬øQu√© es el Punto de Equilibrio?
        </h3>
        <p style="color: #856404; margin-bottom: 15px; font-size: 14px;">
            El punto de equilibrio es la cantidad m√≠nima de unidades que debe fabricar para cubrir todos sus costos (fijos y variables).
        </p>
        <div style="color: #856404; font-size: 14px;">
            <div style="margin: 10px 0; padding: 10px; background-color: rgba(255,255,255,0.7); border-radius: 6px;">
                <strong>üìå Costos Fijos:</strong> Gastos que no cambian independiente de la producci√≥n (arriendo, salarios, servicios)
            </div>
            <div style="margin: 10px 0; padding: 10px; background-color: rgba(255,255,255,0.7); border-radius: 6px;">
                <strong>üìå Costos Variables:</strong> Gastos que cambian seg√∫n la cantidad producida
            </div>
            <div style="margin: 10px 0; padding: 10px; background-color: rgba(255,255,255,0.7); border-radius: 6px;">
                <strong>üìå F√≥rmula:</strong> Punto de Equilibrio = Costos Fijos √∑ Precio por Unidad
            </div>
        </div>
    </div>
</div>

<script>
async function cargarDatos() {
    try {
        const response = await fetch('/api/trabajadores');
        const resultado = await response.json();
        
        if (resultado.success && resultado.data.length > 0) {
            const trabajadores = resultado.data;
            
            // Buscar salarios
            const operarias = trabajadores.filter(t => t.cargo.toLowerCase() === 'operaria');
            const aprendices = trabajadores.filter(t => t.cargo.toLowerCase() === 'aprendiz');
            
            let salario_op = 56000;
            let salario_ap = 30000;
            
            if (operarias.length > 0) {
                salario_op = operarias[0].salario;
            }
            if (aprendices.length > 0) {
                salario_ap = aprendices[0].salario;
            }
            
            // Actualizar UI
            document.getElementById('cargando').style.display = 'none';
            document.getElementById('formulario_equilibrio').style.display = 'block';
            document.getElementById('info_trabajadores').style.display = 'block';
            
            document.getElementById('salario_operarias').textContent = 
                `Salario diario: $${salario_op.toLocaleString('es-CO')} COP`;
            document.getElementById('salario_prestaciones').textContent = 
                `Salario diario: $${salario_op.toLocaleString('es-CO')} COP`;
            document.getElementById('salario_aprendices').textContent = 
                `Salario diario: $${salario_ap.toLocaleString('es-CO')} COP`;
            
        } else {
            document.getElementById('cargando').innerHTML = `
                <div style="background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); padding: 40px; border-radius: 12px; text-align: center; border-left: 5px solid #e74c3c;">
                    <p style="color: #721c24; font-size: 16px; margin-bottom: 10px;">
                        <i style="font-size: 32px; margin-right: 10px;">‚ö†Ô∏è</i>
                        <strong>No hay trabajadores registrados</strong>
                    </p>
                    <p style="color: #721c24; margin-bottom: 15px;">Por favor, agregue trabajadores primero</p>
                    <a href="/agregar-trabajador" class="btn" style="background: linear-gradient(135deg, #27ae60 0%, #229954 100%); text-decoration: none; display: inline-block; width: auto;">
                        <i style="margin-right: 8px;">‚ûï</i> Agregar Trabajador
                    </a>
                </div>
            `;
        }
    } catch (error) {
        document.getElementById('cargando').innerHTML = `
            <div style="background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%); padding: 40px; border-radius: 12px; text-align: center; border-left: 5px solid #e74c3c;">
                <p style="color: #721c24; font-size: 16px;">Error: ${error.message}</p>
            </div>
        `;
    }
}

// Cargar datos al abrir la p√°gina
document.addEventListener('DOMContentLoaded', cargarDatos);
</script>
{% endblock %}