{% extends "base.html" %}

{% block title %}Agregar Taller - Sistema de Gesti√≥n{% endblock %}

{% block content %}
<a href="/menu" class="btn back-btn">
    <i style="margin-right: 8px;">‚Üê</i> Volver al men√∫
</a>

<h1>‚ûï Agregar Nuevo Taller</h1>
<p class="subtitle">
    Complete el formulario para registrar un nuevo taller en el sistema
</p>

<div style="max-width: 600px; margin: 0 auto;">
    <form id="formulario_taller" method="POST" onsubmit="enviarFormulario(event)">
        <div class="form-group">
            <label for="owner">
                <i style="color: #0B1023; margin-right: 8px;">üè≠</i> Propietario:
            </label>
            <input 
                type="text" 
                id="owner" 
                name="owner"  
                required
                placeholder="Ej: Juan P√©rez Garc√≠a"
            >
        </div>

        <button type="submit" class="btn">
            <i style="margin-right: 8px;">‚úì</i> Registrar Taller
        </button>
    </form>

    <div id="mensaje_resultado" style="display: none; margin-top: 20px; padding: 20px; border-radius: 12px; text-align: center;">
    </div>
</div>

<div style="margin-top: 40px; padding: 25px; background: linear-gradient(135deg, #0B1023 0%, #0B1023 100%); border-radius: 12px; border-left: 5px solid #0B1023;">
    <h3 style="margin-top: 0; color: #2c3e50;">
        <i style="margin-right: 8px;">‚ÑπÔ∏è</i> Informaci√≥n importante:
    </h3>
    <div style="color: #555; font-size: 14px;">
        <div style="margin: 10px 0; padding: 10px; background-color: rgba(255,255,255,0.7); border-radius: 6px;">
            <strong>üìå Campo obligatorio:</strong> Nombre del propietario del taller
        </div>
        <div style="margin: 10px 0; padding: 10px; background-color: rgba(255,255,255,0.7); border-radius: 6px;">
            <strong>üìå Propietario:</strong> Ingrese el nombre completo de la persona responsable del taller
        </div>
        <div style="margin: 10px 0; padding: 10px; background-color: rgba(255,255,255,0.7); border-radius: 6px;">
            <strong>üìå Registro:</strong> Una vez registrado, el taller quedar√° disponible en el sistema
        </div>
    </div>
</div>

<script>
async function enviarFormulario(event) {
    event.preventDefault();

    const owner = document.getElementById('owner').value;
    const mensajeDiv = document.getElementById('mensaje_resultado');

    try {
        const response = await fetch('/api/factory', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ owner: owner })
        });

        const resultado = await response.json();
        mensajeDiv.style.display = 'block';

        if (response.ok) {
            mensajeDiv.style.background = 'linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%)';
            mensajeDiv.style.color = '#155724';
            mensajeDiv.style.borderLeft = '5px solid #28a745';
            mensajeDiv.innerHTML = `
                <h4 style="margin-top: 0;">‚úÖ ¬°Taller registrado exitosamente!</h4>
                <div style="margin: 15px 0; padding: 10px; background-color: rgba(255,255,255,0.7); border-radius: 6px;">
                    <p><strong>ID:</strong> ${resultado.id_factory}</p>
                </div>
                <div style="margin: 15px 0; padding: 10px; background-color: rgba(255,255,255,0.7); border-radius: 6px;">
                    <p><strong>Propietario:</strong> ${resultado.owner}</p>
                </div>
                <p style="margin-bottom: 0;"><a href="/factories" style="color: #28a745; text-decoration: none; font-weight: bold;">Ver lista de talleres ‚Üí</a></p>
            `;
            document.getElementById('formulario_taller').reset();
        } else {
            mensajeDiv.style.background = 'linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%)';
            mensajeDiv.style.color = '#721c24';
            mensajeDiv.style.borderLeft = '5px solid #e74c3c';
            mensajeDiv.innerHTML = `
                <h4 style="margin-top: 0;">‚ùå Error al registrar</h4>
                <p>${resultado.detail || 'Error desconocido'}</p>
            `;
        }
    } catch (error) {
        mensajeDiv.style.display = 'block';
        mensajeDiv.style.background = 'linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%)';
        mensajeDiv.style.color = '#721c24';
        mensajeDiv.style.borderLeft = '5px solid #e74c3c';
        mensajeDiv.innerHTML = `
            <h4 style="margin-top: 0;">‚ùå Error de conexi√≥n</h4>
            <p>${error.message}</p>
        `;
    }
}
</script>
{% endblock %}
